version: "0.0.1"

stage:
  stage1:
    
    step:
      step1:
        let:
          foo: "{{case.foo}}"
          bar: "{{case.bar}}"
        exec:
          action: lua
          args:
            code: |
              for i = 1, 5 do
                  n = math.random(100)
                  print("hello lua: " .. tostring(n));
              end
              
              return
              {
                   {
                      ['foo'] = {{foo}}
                  }
                  ,
                  {
                      ['bar'] = {{bar}}
                  }
              }
        
        assert: |
          (all
              (eq value.1.bar (num bar))
          )
      
      step2:
        exec:
          action: lua
          args:
            global:
              arr1: [ "a", "b" ]
              arr2: {
                "foo": "bar"
              }
            code: |
              table.insert(arr1, "c");
              table.insert(arr1, arr2);
              return arr1;
        assert: |
          (all
              (eq value.1 "b")
              (eq value.2 "c")
              (eq value.3.foo "bar")
          )